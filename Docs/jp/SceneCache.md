# Scene Cache
Scene Cache は DCC 上のシーンを各フレームそのままファイルに保存しておき、Unity で再生する仕組みです。  
DCC 側のモデル、カメラ、アニメーションを忠実に、かつ高速に再生することを目的としています。  

非常に近いものとして Alembic が挙げられます。Alembic との最大の違いは再生速度です。[AlembicForUnity](https://docs.unity3d.com/Packages/com.unity.formats.alembic@latest/index.html) で Alembic 再生するよりも SceneCache の方が数倍速くなります。  
他にはマテリアルのサポートなど Alembic にはない要素が追加されていたり、DCC ツールによっては SceneCache の方が再現度が高いこともあります。  
(例：3ds max の標準の Alembic exporter はレンダリング用 Mesh のエクスポートはサポートしていませんが、SceneCache は可能です)  
代償として、現状 Unity でしか再生できない、バージョンアップで互換性が失われて再エクスポートが必要になる可能性が高い等、汎用性をほぼ捨てているという欠点もあります。

<img align="right" src="../Images/SceneCacheExport3DSMax.png" height=600>
右図は 3ds max のエクスポート設定ですが、どのツールも設定は大体同じ内容です。


## Exporting

### Export
"All Nodes" だとシーン内の全ノードを、"Selected Nodes" だと選択されたノードのみをエクスポートします。

### Animation
エクスポートするフレームの範囲を指定します。

##### Samples per Frame
サンプルレート (キャプチャの頻度) の設定です。  
1 であればフレームレートがそのままサンプルレートになります (max が 24 FPS であればキャッシュも 24 FPS)。
0.5 にすると 2 フレーム毎にキャプチャされます (24 FPS -> 12 FPS)。

### Export Data
##### ZSTD Compression Level
圧縮レベルの設定です。  
最大 22 で、上げるとファイルサイズは縮みますがインポート/エクスポートにかかる時間は大きく増えます。
最大でもそこまで劇的には縮まないため、多くの場合デフォルト設定のままが望ましい結果になると思われます。  
圧縮は可逆であり、品質の劣化はありません。

##### Materials
マテリアルのエクスポート設定です。  
"One Frame" だと最初の 1 フレームだけ、"All Frames" だと全フレームのマテリアルデータをエクスポートします。
現状マテリアルのサポートは弱く、基本的に Unity 側で再セットアップする想定なため、"One Frame" をデフォルトとしています。

##### Flatten Hierarchy
有効な場合、Mesh や Camera 等、必要なノードのみをルートノードとしてエクスポートします。  
中間のレンダリングに影響しないノードは無視されます。Unity 側で若干の再生の高速化を期待できます。

##### Strip Normals/Tangents
これらが有効な場合、法線/接線 (Tangents) はエクスポートせず、再生時にその場で計算するようになります。  
法線は手動で編集してある可能性があるため、デフォルトでエクスポートする設定になっています。
接線はエクスポートするとファイルサイズが大きく増え、それに伴って圧縮/解凍の時間も増えるため、エクスポートするメリットが薄いです。そのため、デフォルトでエクスポートしない設定になっています。(今後のアップデートで改善される可能性はあります)


